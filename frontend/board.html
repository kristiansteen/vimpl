<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vimpl - Visual Planning Board</title>

    <!-- GridStack CSS -->
    <link href="https://cdn.jsdelivr.net/npm/gridstack@10.0.0/dist/gridstack.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/gridstack@10.0.0/dist/gridstack-extra.min.css" rel="stylesheet" />

    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Birthstone&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="assets/css/board.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/oidc-client-ts/2.2.0/oidc-client-ts.min.js"></script>
</head>

<body>
    <!-- Header -->
    <header class="header">
        <a href="index.html" class="logo-link" title="Back to Home">
            <div class="logo">vimpl<span>.com</span></div>
        </a>
        <div class="header-title">
            <input type="text" id="projectTitle" class="project-title-input" value="Project name"
                placeholder="Enter project name..." />
        </div>
        <div class="header-controls">
            <div id="auth-container"></div>
            <div class="autosave-indicator" id="autosaveIndicator">
                <span class="autosave-dot"></span>
                <span class="autosave-text">All changes saved</span>
            </div>
            <a href="dashboard.html" class="btn btn-secondary" id="goDashboard" title="Back to Dashboard">
                <i class="fas fa-th-large"></i> Dashboard
            </a>
            <button class="btn btn-secondary" id="newBoard">
                <i class="fas fa-file"></i> New
            </button>
            <button class="btn btn-secondary" id="editLayout" style="display:none;">
                <i class="fas fa-pen-to-square"></i> Edit Layout
            </button>
            <button class="btn btn-secondary" id="toggleGrid">
                <i class="fas fa-th"></i> Grid
            </button>
            <button class="btn btn-secondary" id="showBackend">
                <i class="fas fa-database"></i> Events
            </button>
            <button class="btn btn-primary" id="exportBoard">
                <i class="fas fa-download"></i> Export
            </button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <button class="sidebar-btn active" id="selectTool" title="Select">
                <i class="fas fa-mouse-pointer"></i>
            </button>
            <button class="sidebar-btn" id="addSection" title="Add Section">
                <i class="fas fa-plus"></i>
            </button>

            <div class="sidebar-divider"></div>

            <div class="sidebar-label">Notes</div>
            <div class="postit-palette" id="postitPalette">
                <div class="postit-color yellow" data-color="yellow" title="Yellow"></div>
                <div class="postit-color pink" data-color="pink" title="Pink"></div>
                <div class="postit-color blue" data-color="blue" title="Blue"></div>
                <div class="postit-color green" data-color="green" title="Green"></div>
                <div class="postit-color orange" data-color="orange" title="Orange"></div>
            </div>
        </aside>

        <!-- Board Area -->
        <main class="board-area" id="boardArea">
            <div class="grid-background" id="gridBackground"></div>
            <div class="grid-stack" id="board"></div>
        </main>
    </div>

    <!-- Post-it Form (appears on double-click) -->
    <div class="postit-form" id="postitForm" style="display: none;">
        <button class="close-form" id="closePostitForm">&times;</button>
        <h4><i class="fas fa-sticky-note"></i> <span id="formTitle">Edit Note</span></h4>

        <div class="form-group">
            <label>Content</label>
            <textarea id="formContent" placeholder="Enter note content..."></textarea>
        </div>

        <div class="form-group">
            <label>Owner</label>
            <select id="formOwner">
                <option value="">-- Select Owner --</option>
            </select>
        </div>

        <div class="form-group">
            <label>Status</label>
            <select id="formStatus">
                <option value="todo">To Do</option>
                <option value="inprogress">In Progress</option>
                <option value="done">Done</option>
            </select>
        </div>

        <!-- Risk Matrix Fields (shown conditionally) -->
        <div id="riskFields" style="display: none;">
            <div class="form-row">
                <div class="form-group">
                    <label id="xAxisLabel">X Value (1-100)</label>
                    <input type="number" id="formXValue" min="1" max="100" value="50">
                </div>
                <div class="form-group">
                    <label id="yAxisLabel">Y Value (1-100)</label>
                    <input type="number" id="formYValue" min="1" max="100" value="50">
                </div>
            </div>
            <div class="form-group">
                <label>Risk Score</label>
                <div class="score-display" id="scoreDisplay">2500</div>
            </div>
            <div class="form-group">
                <label>Mitigation (max 255 chars)</label>
                <textarea id="formMitigation" maxlength="255" placeholder="Describe mitigation strategy..."></textarea>
            </div>
        </div>
    </div>

    <!-- Instructions -->
    <div class="instructions" id="instructions">
        <button class="close-btn" onclick="this.parentElement.style.display='none'">&times;</button>
        <h4><i class="fas fa-lightbulb"></i> Quick Start</h4>
        <ul>
            <li><strong>Add Note:</strong> Click color â†’ click section</li>
            <li><strong>Edit Note:</strong> Double-click to open form</li>
            <li><strong>Move Note:</strong> Drag within sections</li>
            <li><strong>Lock Section:</strong> Click lock icon</li>
            <li><strong>Auto-save:</strong> Changes save automatically</li>
        </ul>
    </div>

    <!-- Backend Event Log Modal -->
    <div class="modal-overlay" id="backendModal">
        <div class="modal">
            <div class="modal-header">
                <h2><i class="fas fa-database"></i> Event Log</h2>
                <button class="modal-close" id="closeBackend">&times;</button>
            </div>
            <div class="modal-body">
                <div class="tabs">
                    <button class="tab active" data-tab="events">All Events</button>
                    <button class="tab" data-tab="postits">Post-it Data</button>
                    <button class="tab" data-tab="matrix">Matrix Positions</button>
                </div>
                <div id="eventsTab">
                    <table class="event-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Event</th>
                                <th>Element ID</th>
                                <th>Type</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="eventLogBody"></tbody>
                    </table>
                </div>
                <div id="postitsTab" style="display:none;">
                    <table class="event-table">
                        <thead>
                            <tr>
                                <th>Color</th>
                                <th>Content</th>
                                <th>Owner</th>
                                <th>Status</th>
                                <th>Week / Column</th>
                                <th>Track / Row</th>
                                <th>ID</th>
                            </tr>
                        </thead>
                        <tbody id="postitLogBody"></tbody>
                    </table>
                </div>
                <div id="matrixTab" style="display:none;">
                    <table class="event-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Post-it ID</th>
                                <th>Matrix</th>
                                <th>X-Axis</th>
                                <th>X (0-100)</th>
                                <th>Y-Axis</th>
                                <th>Y (0-100)</th>
                                <th>Score</th>
                            </tr>
                        </thead>
                        <tbody id="matrixLogBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Section Modal -->
    <div class="modal-overlay" id="addSectionModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Add New Section</h2>
                <button class="modal-close" id="closeAddSection">&times;</button>
            </div>
            <div class="modal-body">
                <div class="section-types" id="sectionTypes">
                    <div class="section-type-card" data-type="text">
                        <i class="fas fa-align-left"></i>
                        <h3>Text Section</h3>
                        <p>Simple text area for notes</p>
                    </div>
                    <div class="section-type-card" data-type="team">
                        <i class="fas fa-users"></i>
                        <h3>Team Section</h3>
                        <p>Team members with name & email</p>
                    </div>
                    <div class="section-type-card" data-type="kpi">
                        <i class="fas fa-chart-line"></i>
                        <h3>KPI Section</h3>
                        <p>Key performance indicators</p>
                    </div>
                    <div class="section-type-card" data-type="matrix">
                        <i class="fas fa-th-large"></i>
                        <h3>2x2 Matrix</h3>
                        <p>Risk/Impact analysis grid</p>
                    </div>
                    <div class="section-type-card" data-type="weekplan">
                        <i class="fas fa-calendar-alt"></i>
                        <h3>Week Planner</h3>
                        <p>Weekly schedule with tracks</p>
                    </div>
                    <div class="section-type-card" data-type="actions">
                        <i class="fas fa-tasks"></i>
                        <h3>Actions Table</h3>
                        <p>Action items with owners</p>
                    </div>
                    <div class="section-type-card" data-type="postit-area">
                        <i class="fas fa-sticky-note"></i>
                        <h3>Post-it Area</h3>
                        <p>Free area for sticky notes</p>
                    </div>
                    <div class="section-type-card" data-type="kanban">
                        <i class="fas fa-columns"></i>
                        <h3>Kanban Board</h3>
                        <p>Todo, In Progress, Done columns</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- GridStack JS -->
    <script src="https://cdn.jsdelivr.net/npm/gridstack@10.0.0/dist/gridstack-all.js"></script>
    <script src="assets/js/api-client.js"></script>
    <script src="assets/js/auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const authContainer = document.getElementById('auth-container');
            const user = getCurrentUser();

            if (user) {
                authContainer.innerHTML = `
            <span class="nav-user" style="color: #fff; margin-right: 1rem;">Hello, ${user.name}</span>
            <a href="#" onclick="logout()" class="btn btn-secondary">Logout</a>
          `;
            }
        });
    </script>
    <script src="assets/js/board.js"></script>
</body>

</html>